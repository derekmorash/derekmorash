<html lang="en" class="no-js">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Rails 5 Shopify App With Redis Sidekiq Docker</title>

  
<script>
  (function(){var docElement=document.documentElement;docElement.className=docElement.className.replace('no-js','js');function getCookieValue(cookie_name){cookie_name+="=";var cookie_value=false;var decoded_cookie=decodeURIComponent(document.cookie);var cookie_start=decoded_cookie.indexOf(cookie_name);var cookie_end=decoded_cookie.indexOf(";",cookie_start+1);cookie_end=cookie_end>1?cookie_end:decoded_cookie.length;if(cookie_start>=0&&cookie_end<=decoded_cookie.length){cookie_value=decoded_cookie.substring(cookie_start+cookie_name.length,cookie_end);}
if(cookie_value==="true"){cookie_value=true;}else if(cookie_value==="false"){cookie_value=false;}
return cookie_value;}
if(getCookieValue('inter-loaded')){docElement.className+=" inter-loaded";}})();
</script>





<script src="https://derekmorash.com/js/bundle.min.8a17fdd9466c77f7aa941806a4678d846c3a3c71c180eef34ebb4fed663a692f.js"></script>
  


<style>
       

  /*!normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css*/html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}progress{vertical-align:baseline}template,[hidden]{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}button,input,select,textarea{font:inherit;margin:0}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}html{box-sizing:border-box;font-size:16px;background:#f6f6f6}@media(min-width:1280px){html{font-size:18px}}*,*::before,*::after{box-sizing:border-box}body{font-size:1rem;font-family:Helvetica,Arial,Verdana,sans-serif;font-family:inter,Helvetica,Arial,Verdana,sans-serif;font-weight:400;font-style:normal;letter-spacing:.002em;line-height:1.5;background:#f6f6f6;color:#262626}html.inter-loaded body{font-family:inter,Helvetica,Arial,Verdana,sans-serif}p{margin:.5rem 0}em{font-size:1rem;font-style:italic}strong{font-weight:600;font-style:normal;color:#000}a{color:#262626;text-decoration:underline;text-decoration-skip:objects;text-decoration-color:#009ec2;transition:color .05s}a:hover,a:hover:visited{color:#009ec2}h1,h2,h3,h4,h5,h6{margin:1.75em 0 .75rem;font-weight:600;font-style:normal;line-height:1.1;letter-spacing:-.03em;color:#000}h1{font-size:2.255rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5{font-size:1.25rem}h6{font-size:1.25rem}h1+h2,h2+h3,h3+h4,h4+h5,h5+h6{margin-top:0}img{max-width:100%;height:auto}pre{overflow:scroll}figure{margin:1rem 0}
</style>

  
  <link rel="stylesheet" href="https://derekmorash.com/sass/main.min.70c065ee61e73218973f973e6404f6cb53da33de57439b84dc6124a17c78e1b7.css" integrity=”sha256-cMBl7mHnMhiXP5c&#43;ZAT2y1PaM95XQ5uE3GEkoXx44bc&#61;”>
</head>

<body>
  <header role="banner" class="site-header">
    <div class="site-header__inner">
      <h1 class="logo"><a href="/">Derek Morash</a></h1>

      <nav role="navigation" id="site-navigation" class="site-navigation">
        <ul>
          
          
            <li>
              <a href="/about/">About</a>
            </li>
          
            <li>
              <a href="/blog/">Blog</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
 
<main class="site-main">
  <article role="main" class="blog-post">
    <header class="blog-post__header">
      <div class="blog-post__header--inner">
        <h1>Rails 5 Shopify App With Redis Sidekiq Docker</h1>
  
        
        <aside class="postmetadata">Posted on <time datetime="2018-11-15 23:51:24 -0400 AST">2018-11-15 23:51:24 -0400 AST</time></aside>
      </div>
    </header>

    <section class="blog-post__content rte">
      

<h2 id="goals">Goals</h2>

<ol>
<li>Create a new Rails 5 app</li>
<li>Use the shopify_app gem for app architecture and API access</li>
<li>Redis and Sidekiq for jobs</li>
<li>Develop locally with the app contained in Docker</li>
</ol>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
<li>Experience with Ruby and Rails</li>

<li><p>Updated versions of Ruby, Rails, and Docker.</p>

<ol>
<li><a href="https://gorails.com/setup/">Install Ruby On Rails</a></li>
<li><a href="https://www.docker.com/get-started">Get started with Docker</a>
<br /></li>
</ol></li>

<li><p>Docker experience</p></li>

<li><p>ngrok account created and installed. <a href="https://dashboard.ngrok.com/user/signup">Get started with ngrok</a></p></li>
</ol>

<h2 id="1-create-a-new-rails-app-using-postgres-as-the-database">1. Create a new rails app using postgres as the database</h2>

<pre><code>rails new app_name -d postgresql
</code></pre>

<p>Be sure to change <code>app_name</code> to your apps name.</p>

<h2 id="2-set-up-docker-in-your-new-rails-app">2. Set up docker in your new rails app</h2>

<ol>
<li>Add <code>.env</code> to <code>.gitignore</code></li>

<li><p>Create <code>.env.template</code> with the following:</p>

<pre><code>COMPOSE_PROJECT_NAME=app_name

RAILS_ENV=development
SECRET_TOKEN=asecuretokenwouldnormallygohere

BIND_ON=0.0.0.0:5000
RAILS_MAX_THREADS=1
WEB_CONCURRENCY=1

DATABASE_URL=postgresql://app_name_development:yourpassword@postgres:5432/app_name_development?encoding=utf8&amp;pool=5&amp;timeout=5000

POSTGRES_DB='app_name_development'
POSTGRES_USER='app_name_development'
POSTGRES_PASSWORD='yourpassword'

REDIS_DEV_URL=redis://redis:6379/0

SHOPIFY_API_KEY=
SHOPIFY_API_SECRET_KEY=
APP_BASE_URL=

assets=precompile
</code></pre></li>
</ol>

<p>Be sure to change <code>app_name</code> to your apps name in POSTGRES_DB and POSTGRES_USER.</p>

<ol>
<li>Copy <em>.env.template</em> to <em>.env</em></li>
</ol>

<p>The values for <code>SHOPIFY_API_KEY</code>, <code>SHOPIFY_API_SECRET_KEY</code>, and <code>APP_BASE_URL</code> will be updated later.</p>

<p><em>.env.template</em> is committed to git as a starting point for others to develop locally. <em>.env</em> is ignored from git because it will have API keys and secrets that no one should have access to.</p>

<ol>
<li><p>Create <em>.dockerignore</em> with the following:</p>

<pre><code>.byebug_history
.dockerignore
.git
log/*
tmp/*
</code></pre></li>

<li><p>Create <em>Dockerfile</em> with the following:</p>

<pre><code>FROM ruby:2.5.1-alpine

RUN apk update &amp;&amp; apk add build-base nodejs postgresql-dev

RUN mkdir /app
WORKDIR /app

COPY Gemfile Gemfile.lock ./
RUN bundle install --binstubs

COPY . .

LABEL maintainer=&quot;Able Sense &lt;support@ablesense.com&gt;&quot;

CMD puma -C config/puma.rb
</code></pre></li>
</ol>

<p>This sets up the container for the rails server. It first installs some packages we&rsquo;ll need, copies Gemfile and Gemfile.lock (more on this later), runs bundle install, copies the app into the container, then starts the server.</p>

<p>Using the alpine version of images to reduce size. Alpine has all the features we should need.</p>

<ol>
<li><p>Create <em>docker-compose.yml</em> with the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">version: <span style="color:#e6db74">&#39;3&#39;</span>

services:
  postgres:
    image: <span style="color:#e6db74">&#39;postgres:10.4-alpine&#39;</span>
    environment:
      POSTGRES_DB: <span style="color:#e6db74">&#39;shopify_base_app_development&#39;</span>
      POSTGRES_USER: <span style="color:#e6db74">&#39;shopify_base_app_development&#39;</span>
      POSTGRES_PASSWORD: <span style="color:#e6db74">&#39;yourpassword&#39;</span>
    volumes:
      - <span style="color:#e6db74">&#39;postgres:/var/lib/postgresql/data&#39;</span>
    env_file:
      - <span style="color:#e6db74">&#39;.env&#39;</span>

  redis:
    image: <span style="color:#e6db74">&#39;redis:4.0-alpine&#39;</span>
    command: redis-server
    volumes:
      - <span style="color:#e6db74">&#39;redis:/data&#39;</span>
    env_file:
      - <span style="color:#e6db74">&#39;.env&#39;</span>

  web:
    depends_on:
      - <span style="color:#e6db74">&#39;postgres&#39;</span>
      - <span style="color:#e6db74">&#39;redis&#39;</span>
    build: .
    ports:
      - <span style="color:#e6db74">&#39;3000:3000&#39;</span>
    env_file:
      - <span style="color:#e6db74">&#39;.env&#39;</span>
    volumes:
      - <span style="color:#e6db74">&#39;.:/app&#39;</span>

  sidekiq:
    depends_on:
      - <span style="color:#e6db74">&#39;postgres&#39;</span>
      - <span style="color:#e6db74">&#39;redis&#39;</span>
    build: .
    command: sidekiq -C config/sidekiq.yml.erb
    volumes:
      - <span style="color:#e6db74">&#39;.:/app&#39;</span>
    env_file:
      - <span style="color:#e6db74">&#39;.env&#39;</span>

volumes:
  redis: {}
  postgres: {}</code></pre></div></li>
</ol>

<p>Docker compose is used to run our containers and setup any others we may need like postgres, redis, and sidekiq. Each services has some configuration options set to allow the containers to talk to each other. Be sure to change <code>app_name</code> to your apps name.</p>

<h2 id="3-setup-ngrok">3. Setup ngrok</h2>

<h3 id="are-you-using-a-custom-subdomain">Are you using a custom subdomain?</h3>

<ul>
<li><p><strong>YES?</strong></p>

<p>Log into your ngrok dashboard and go to <a href="https://dashboard.ngrok.com/reserved">https://dashboard.ngrok.com/reserved</a>.</p>

<p>If you already have a subdomain reserved find it in the list and copy just the subdomain, leave off the <code>.ngrok.io</code>.</p>

<p>If you haven&rsquo;t already reserved a subdomain then create a new one on that same page.</p>

<p><img src="/blog/rails-5-shopify-app-with-redis-sidekiq-docker/reserve-subdomain.png" alt="Reserve ngrok subdomain" /></p>

<p>In your terminal run:</p>

<pre><code>ngrok http -subdomain=my-app 3000
</code></pre></li>

<li><p><strong>NO?</strong></p>

<p>In your terminal run:</p>

<pre><code>ngrok http 3000
</code></pre>

<p><em>Note that if you&rsquo;re not using a reserved subdomain you will have to update the url for your app in the partners dashboard every time you restart ngrok.</em></p></li>
</ul>

<p>Now that ngrok is listening on port 3000 it will list some info. Look for the forwarding address that uses https and copy it for use in the next step.</p>

<h2 id="4-create-a-new-app-in-the-shopify-partners-dashboard">4. Create a new app in the Shopify partners dashboard</h2>

<p>Log into your Shopify Partners dashboard to create a new app. Click here to <a href="https://www.shopify.ca/partners?ref=ablesense">become a shopify partner</a> if you aren&rsquo;t already signed up.</p>

<p>Find the apps link in the dashboard on the left then click create app. You&rsquo;ll get a popup like this.</p>

<p><img src="/blog/rails-5-shopify-app-with-redis-sidekiq-docker/shopify-dashboard-create-app.png" alt="Create app prompt for shopify dashboard" /></p>

<p>Here you will give the app a name, and the URL for your new local app. The URL is the forwarding address that was created in the previous step by ngrok.</p>

<p><em>Note that if you&rsquo;re not using a reserved subdomain you will have to update the url for your app in the partners dashboard every time you restart ngrok.</em></p>

<h2 id="5-app-configuration-for-local-development">5. App configuration for local development</h2>

<ol>
<li><p>Open <code>.env</code> and update the following</p>

<ol>
<li><code>COMPOSE_PROJECT_NAME</code> name of your app</li>
<li><code>SHOPIFY_API_KEY</code> provided by shopify after creating a new app</li>
<li><code>SHOPIFY_API_SECRET_KEY</code> provided by shopify after creating a new app</li>
<li><code>APP_BASE_URL</code> the ngrok forwarding URL</li>
</ol></li>

<li><p>Open <code>config/database.yml</code></p></li>
</ol>

<p>Under the <code>development</code> section add the following lines:</p>

<pre><code>``` yml
database: &lt;%= ENV['POSTGRES_DB'] %&gt;
username: &lt;%= ENV['POSTGRES_USER'] %&gt;
password: &lt;%= ENV['POSTGRES_PASSWORD'] %&gt;
```
</code></pre>

<ol>
<li><p>Create <code>config/initializers/sidekiq.rb</code> with the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rb" data-lang="rb"><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>development?
  <span style="color:#66d9ef">Sidekiq</span><span style="color:#f92672">.</span>configure_client <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
    config<span style="color:#f92672">.</span>redis <span style="color:#f92672">=</span> { <span style="color:#e6db74">url</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;REDIS_DEV_URL&#39;</span><span style="color:#f92672">]</span>, <span style="color:#e6db74">size</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;SIDEKIQ_CONNECTIONS&#39;</span><span style="color:#f92672">]</span> }
  <span style="color:#66d9ef">end</span>

  <span style="color:#66d9ef">Sidekiq</span><span style="color:#f92672">.</span>configure_server <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
    config<span style="color:#f92672">.</span>redis <span style="color:#f92672">=</span> { <span style="color:#e6db74">url</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;REDIS_DEV_URL&#39;</span><span style="color:#f92672">]</span> }

    <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>application<span style="color:#f92672">.</span>config<span style="color:#f92672">.</span>after_initialize <span style="color:#66d9ef">do</span>
      <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;DB Connection Pool size for Sidekiq Server before disconnect is: </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>instance_variable_get(<span style="color:#e6db74">&#39;@size&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
      <span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection_pool<span style="color:#f92672">.</span>disconnect!

      <span style="color:#66d9ef">ActiveSupport</span><span style="color:#f92672">.</span>on_load(<span style="color:#e6db74">:active_record</span>) <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>establish_connection
        <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;DB Connection Pool size for Sidekiq Server is now: </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>instance_variable_get(<span style="color:#e6db74">&#39;@size&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
      <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">if</span> <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>production?

  <span style="color:#66d9ef">Sidekiq</span><span style="color:#f92672">.</span>configure_client <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
    config<span style="color:#f92672">.</span>redis <span style="color:#f92672">=</span> { <span style="color:#e6db74">url</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;REDIS_URL&#39;</span><span style="color:#f92672">]</span>, <span style="color:#e6db74">size</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;SIDEKIQ_CONNECTIONS&#39;</span><span style="color:#f92672">]</span> }
  <span style="color:#66d9ef">end</span>

  <span style="color:#66d9ef">Sidekiq</span><span style="color:#f92672">.</span>configure_server <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
    config<span style="color:#f92672">.</span>redis <span style="color:#f92672">=</span> { <span style="color:#e6db74">url</span>: <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;REDIS_URL&#39;</span><span style="color:#f92672">]</span> }

    <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>application<span style="color:#f92672">.</span>config<span style="color:#f92672">.</span>after_initialize <span style="color:#66d9ef">do</span>
      <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;DB Connection Pool size for Sidekiq Server before disconnect is: </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>instance_variable_get(<span style="color:#e6db74">&#39;@size&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
      <span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection_pool<span style="color:#f92672">.</span>disconnect!

      <span style="color:#66d9ef">ActiveSupport</span><span style="color:#f92672">.</span>on_load(<span style="color:#e6db74">:active_record</span>) <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>establish_connection
        <span style="color:#66d9ef">Rails</span><span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;DB Connection Pool size for Sidekiq Server is now: </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Base</span><span style="color:#f92672">.</span>connection<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>instance_variable_get(<span style="color:#e6db74">&#39;@size&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
      <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span></code></pre></div></li>

<li><p>Open <code>Gemfile</code></p>

<ul>
<li>Make sure ruby version is 2.5.1</li>
<li>add <code>gem 'shopify_app'</code> above the rails gem</li>
<li>add <code>gem 'sidekiq'</code></li>
<li>add <code>gem 'redis', '~&gt; 4.0'</code></li>
<li>change <code>gem 'tzinfo-data', platforms: [:mingw, :mswin, :x64_mingw, :jruby]</code> to just be <code>gem 'tzinfo-data'</code>. Our docker container needs to use this gem but by default it is locked down to certain platforms.</li>
</ul></li>

<li><p>Rename <code>Gemfile.lock</code> to <code>Gemfile.lock.old</code>, then create an empty <code>Gemfile.lock</code></p>

<p>Bundle install will fail inside the docker container if this file was created when creating the rails app on our local machine. We want to let docker create it&rsquo;s own lock file from our updated Gemfile.</p></li>
</ol>

<h2 id="6-build-and-spin-up-the-docker-containers">6. Build and spin up the docker containers</h2>

<p>Now that everything is configured we can build our containers and get them up and running to start working on our app.</p>

<ul>
<li>run <code>docker-compose build</code> to download the images and build the containers. This may take a few minutes.</li>
<li>in a new terminal start ngrok if it&rsquo;s not already running. <code>ngrok http 3000</code> or <code>ngrok http -subdomain=my-app 3000</code></li>
<li>run <code>docker-compose up</code> to get the containers running with the settings from docker-compose.yml</li>
<li>in a new terminal run <code>docker-compose ps</code> to view the status of containers in this project</li>
<li>run <code>docker-compose stop</code> to stop the containers</li>
</ul>

<p>With ngrok running and all containers up you should be able to open the ngrok forwarding URL in a browser and see the <em>&ldquo;Yay! You&rsquo;re on Rails!&rdquo;</em> screen.</p>

<p><img src="/blog/rails-5-shopify-app-with-redis-sidekiq-docker/welcome-to-rails.jpg" alt="You're on Rails!" /></p>

<h2 id="7-shopify-app-gem-setup">7. Shopify app gem setup</h2>

<p>There are just a few things left to do to turn our Rails app into a Shopify app. With docker running, start by opening a new terminal.</p>

<ol>
<li><p>Generate shopify app. Since we&rsquo;re using environment variables for the app api key and secret we don&rsquo;t want to use the optional arguments for that command.</p>

<pre><code>docker-compose exec web rails generate shopify_app:install
</code></pre></li>

<li><p>Create the shop table, model, and controller</p>

<pre><code>docker-compose exec web rails generate shopify_app:shop_model
</code></pre></li>

<li><p>Run the migrations to create the shop table in the database</p>

<pre><code>docker-compose exec web rails db:migrate
</code></pre></li>

<li><p>Generate resources to create a basic page that installed users will see. This page is just an example use of the Shopify API to print out a few products from the store and list the webhooks set up for this app.</p>

<pre><code>docker-compose exec web rails generate shopify_app:home_controller
</code></pre></li>

<li><p>Open <code>config/initializers/shopify_app.rb</code> and change the following lines:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rb" data-lang="rb">config<span style="color:#f92672">.</span>api_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;SHOPIFY_API_KEY&#39;</span><span style="color:#f92672">]</span>
config<span style="color:#f92672">.</span>secret <span style="color:#f92672">=</span> <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;SHOPIFY_API_SECRET_KEY&#39;</span><span style="color:#f92672">]</span></code></pre></div></li>
</ol>

<h2 id="8-get-to-work">8. Get to work</h2>

<p>With ngrok running and all containers up you should be able to open the ngrok forwarding URL in a browser and see the shopify app install screen.</p>

<p><img src="/blog/rails-5-shopify-app-with-redis-sidekiq-docker/app-install.png" alt="App install screen" /></p>

<h2 id="helpful-commands">Helpful commands</h2>

<ul>
<li><p>Tail rails logs</p>

<pre><code>docker-compose exec web tail -f log/development.log
</code></pre></li>

<li><p>Rails commands</p>

<pre><code>docker-compose exec web rails db:migrate
</code></pre>

<pre><code>docker-compose exec web rails console
</code></pre></li>

<li><p>Access postgres from the command line</p>

<pre><code>docker-compose exec postgres psql -U app_name_development
</code></pre></li>
</ul>

    </section>
  </article>
</main>
 
</body>
</html>