<html lang="en" class="no-js">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Javascript JSON Search</title>

  
<script>
  (function(){var docElement=document.documentElement;docElement.className=docElement.className.replace('no-js','js');function getCookieValue(cookie_name){cookie_name+="=";var cookie_value=false;var decoded_cookie=decodeURIComponent(document.cookie);var cookie_start=decoded_cookie.indexOf(cookie_name);var cookie_end=decoded_cookie.indexOf(";",cookie_start+1);cookie_end=cookie_end>1?cookie_end:decoded_cookie.length;if(cookie_start>=0&&cookie_end<=decoded_cookie.length){cookie_value=decoded_cookie.substring(cookie_start+cookie_name.length,cookie_end);}
if(cookie_value==="true"){cookie_value=true;}else if(cookie_value==="false"){cookie_value=false;}
return cookie_value;}
if(getCookieValue('inter-loaded')){docElement.className+=" inter-loaded";}})();
</script>





<script src="https://derekmorash.com/js/bundle.min.8a17fdd9466c77f7aa941806a4678d846c3a3c71c180eef34ebb4fed663a692f.js"></script>
  


<style>
       

  /*!normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css*/html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}progress{vertical-align:baseline}template,[hidden]{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}button,input,select,textarea{font:inherit;margin:0}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}html{box-sizing:border-box;font-size:16px;background:#f6f6f6}@media(min-width:1280px){html{font-size:18px}}*,*::before,*::after{box-sizing:border-box}body{font-size:1rem;font-family:Helvetica,Arial,Verdana,sans-serif;font-family:inter,Helvetica,Arial,Verdana,sans-serif;font-weight:400;font-style:normal;letter-spacing:.002em;line-height:1.5;background:#f6f6f6;color:#262626}html.inter-loaded body{font-family:inter,Helvetica,Arial,Verdana,sans-serif}p{margin:.5rem 0}em{font-size:1rem;font-style:italic}strong{font-weight:600;font-style:normal;color:#000}a{color:#262626;text-decoration:underline;text-decoration-skip:objects;text-decoration-color:#009ec2;transition:color .05s}a:hover,a:hover:visited{color:#009ec2}h1,h2,h3,h4,h5,h6{margin:1.75em 0 .75rem;font-weight:600;font-style:normal;line-height:1.1;letter-spacing:-.03em;color:#000}h1{font-size:2.255rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5{font-size:1.25rem}h6{font-size:1.25rem}h1+h2,h2+h3,h3+h4,h4+h5,h5+h6{margin-top:0}img{max-width:100%;height:auto}pre{overflow:scroll}figure{margin:1rem 0}
</style>

  
  <link rel="stylesheet" href="https://derekmorash.com/sass/main.min.70c065ee61e73218973f973e6404f6cb53da33de57439b84dc6124a17c78e1b7.css" integrity=”sha256-cMBl7mHnMhiXP5c&#43;ZAT2y1PaM95XQ5uE3GEkoXx44bc&#61;”>
</head>

<body>
  <header role="banner" class="site-header">
    <div class="site-header__inner">
      <h1 class="logo"><a href="/">Derek Morash</a></h1>

      <nav role="navigation" id="site-navigation" class="site-navigation">
        <ul>
          
          
            <li>
              <a href="/about/">About</a>
            </li>
          
            <li>
              <a href="/blog/">Blog</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
 
<main class="site-main">
  <article role="main" class="blog-post">
    <header class="blog-post__header">
      <div class="blog-post__header--inner">
        <h1>Javascript JSON Search</h1>
  
        
        <aside class="postmetadata">Posted on <time datetime="2016-05-08 00:00:00 &#43;0000 UTC">2016-05-08 00:00:00 &#43;0000 UTC</time></aside>
      </div>
    </header>

    <section class="blog-post__content rte">
      <p>A quick tutorial on how to load JSON data with Ajax and query it with a search string. To see a demo and the working code checkout <a href="http://codepen.io/derekmorash/pen/dGLdxN">this codepen</a>. It was a Javascript challenge exercise by <a href="https://twitter.com/wesbos">Wes Bos</a>, I wrote the Javascript.</p>

<p>This is what it looks like completed. A list of results appear that match the search query.</p>

<p><img src="/blog/javascript-json-search/search.gif" alt="search" title="search" /></p>

<p>First we&rsquo;ll set up our HTML, it&rsquo;s super simple. We&rsquo;ll need an input text box to type our search query into, and an unordered list to display the matched results. I have these wrapped in a form element just to be able to style it, but I won&rsquo;t cover any CSS styling in this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTML" data-lang="HTML">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;search-form&#34;</span>&gt;
  &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;search&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;City or State&#34;</span>&gt;
  &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;suggestions&#34;</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;Filter for a city&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;or a state&lt;/<span style="color:#f92672">li</span>&gt;
  &lt;/<span style="color:#f92672">ul</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;</code></pre></div>
<p>The list item elements that are already in the HTML will be replaced using javascript when the user types.</p>

<p>We can now get ready setup for the Ajax call. First create a variable to store the URL for the JSON file, and a variable that will end up being the array of data in the JSON file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;someData.json&#39;</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> [];
</code></pre></div>
<p>Now we&rsquo;ll start the actual Ajax call. We create a new XMLHttpRequest and use that to GET the file contained at the URL we specified above. We use onreadystatechange to see when there&rsquo;s been a change in the request, or when data has been downloaded. Every time a chunk of data is downloaded check if that was the end of the file, if it is the end of the file then when we store the entire contents into the data variable we created.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xmlhttp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();

<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#a6e22e">url</span>, <span style="color:#66d9ef">true</span>);
<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">send</span>();
<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">onreadystatechange</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
    <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">responseText</span>);
  }
};
</code></pre></div>
<p>Once we have the data we can get into the logic of the search. We&rsquo;ll first need to create a reference to the DOM elements we created in our HTML, the search text box and the display list.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">search</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;.search&#34;</span>);

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">list</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;.suggestions&#34;</span>);
</code></pre></div>
<p>The whole point of an Ajax search is to be able to see live results as you type. So we&rsquo;ll need to create an even listener on the text box to run some code each time the user types a key, everything happens in here.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keyup&#39;</span>, <span style="color:#66d9ef">function</span>() {

});
</code></pre></div>
<p>Each time a key is pressed there needs to be a new regular expression made to match for the query typed in the input box. We&rsquo;ll make a variable called myExp (my expression) that will create a new regular expression using &ldquo;search.value&rdquo;, where search is the reference to the input box we made earlier, and the Javascript RegExp modifiers &ldquo;g&rdquo; and &ldquo;i&rdquo;, &ldquo;g&rdquo; is a global match meaning it doesn&rsquo;t stop at the first match in a string and &ldquo;i&rdquo; means the match is case-insensitive. We&rsquo;ll also create a placeholder variable that will later store our matched results to be outputted to the DOM.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keyup&#39;</span>, <span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">myExp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RegExp(<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">value</span>, <span style="color:#e6db74">&#39;gi&#39;</span>);

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">output</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
});
</code></pre></div>
<p>First thing we want to do when a key is pressed is to check if the text box is empty, if the user hits backspace to clear any characters in the box. If it is empty then we&rsquo;ll take the list element and set it&rsquo;s innerHTML to be empty.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;&#39;</span>) {
  <span style="color:#75715e">//remove all list items
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
}
</code></pre></div>
<p>(note: all of this is still inside the search keyUp function)</p>

<p>If the text box isn&rsquo;t empty, then we loop through all the records in the JSON data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;&#39;</span>) {
  <span style="color:#75715e">//remove all list items
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
} <span style="color:#66d9ef">else</span> {
  <span style="color:#75715e">//loop through the data
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">data</span>) {

  } <span style="color:#75715e">//end for
</span><span style="color:#75715e"></span>
} <span style="color:#75715e">//end else
</span><span style="color:#75715e"></span></code></pre></div>
<p>For each record in the data we want to check if the city or the state of the record matches our RegExp. We check this by using the Javascript search method on the record.</p>

<p>For the city we take the data record at the specific key the loop is at, and search the city object for &ldquo;myExp&rdquo;. &ldquo;(data[key].city.search(myExp) != -1)&rdquo; If this does NOT return a &ldquo;-1&rdquo; then that means the expression matches. Then we use two pipes, &ldquo;||&rdquo;, to indicate if the city OR state gives a match.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">else</span> {
  <span style="color:#75715e">//loop through the data
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">data</span>) {

    <span style="color:#66d9ef">if</span>((<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">city</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)) {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;We have a match!&#39;</span>);
    } <span style="color:#75715e">//end if
</span><span style="color:#75715e"></span>  } <span style="color:#75715e">//end for
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">//put the contents of the output variable into the list
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">output</span>;
} <span style="color:#75715e">//end else
</span><span style="color:#75715e"></span></code></pre></div>
<p>If we find a match we want to add the record info to our &ldquo;output&rdquo; variable. The output variable will hold each matched record found when looping through the data. The info in each matched record will be appended to a string and wrapped in the HTML list tags.</p>

<p>For this example I&rsquo;m using extra span tags just for styling the different info being returned to the list.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">if</span>((<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">city</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)) {

  <span style="color:#a6e22e">output</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;li&gt;&lt;span&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">city</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;, &#39;</span> <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">state</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/span&gt;&#39;</span> <span style="color:#f92672">+</span>
    <span style="color:#e6db74">&#39;&lt;span class=&#34;population&#34;&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">population</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&lt;/span&gt;&#39;</span> <span style="color:#f92672">+</span>
    <span style="color:#e6db74">&#39;&lt;/li&gt;&#39;</span>;

} <span style="color:#75715e">//end if
</span><span style="color:#75715e"></span></code></pre></div>
<p>Now we have to actually display the contents of the &ldquo;output&rdquo; variable in the list for the user to see. An easy mistake can be made here, we don&rsquo;t want to update the DOM every time a match is made inside the loop because there could be hundreds of matches. Updating the DOM that frequently will cause major performance issues, the search will slow down and maybe even cause the browser to lock up or crash.</p>

<p>This is why we store each matched result in the output variable instead of just updating the DOM each time. Looping through each record may seem like it could take a while especially if there&rsquo;s thousands of records, but it&rsquo;s actually very fast (I have this exact code running on a JSON file of 90,000 records and it responds instantly).</p>

<p>So we want to update the list element in the DOM <strong>AFTER</strong> the loop is finished. All we do is grab the list element and set it&rsquo;s innerHTML to be the contents of the &ldquo;output&rdquo; variable.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#66d9ef">else</span> {
  <span style="color:#75715e">//loop through the data
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">data</span>) {
    <span style="color:#66d9ef">if</span>((<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">city</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">||</span> (<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>].<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">search</span>(<span style="color:#a6e22e">myExp</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)) {
      ...
    } <span style="color:#75715e">//end if
</span><span style="color:#75715e"></span>  } <span style="color:#75715e">//end for
</span><span style="color:#75715e"></span>
  <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">output</span>;

} <span style="color:#75715e">//end else
</span><span style="color:#75715e"></span></code></pre></div>
<p>And that&rsquo;s it, we have a search box that returns results instantly without a page reload.</p>

    </section>
  </article>
</main>
 
</body>
</html>