<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="author" content="Derek Morash">
<title>Simple Image Lazy Loading</title>


<meta name="description" content="">



<meta property="og:site_name" content="" />
<meta property="og:locale" content="en_ca">
<meta property="og:title" content="Simple Image Lazy Loading" />
<meta property="og:type" content="video.movie" />

<meta property="og:description" content="" />

<meta property="og:url" content="https://derekmorash.com/blog/simple-image-lazy-loading/" />


  
<script>
  (function(){var docElement=document.documentElement;docElement.classList.replace('no-js','js');if(sessionStorage['noto-serif-400-normal-loaded']){document.documentElement.classList.add("noto-serif-loaded");}
if(sessionStorage['nunito-600-normal-loaded']){document.documentElement.classList.add("nunito-loaded");}})();
</script>





<script src="https://derekmorash.com/js/bundle.min.7016b41c5b556b2557da4ed5b71e6bdb39324aa409aa7c00382b84dca7706c63.js"></script>
  

<link href="https://fonts.googleapis.com/css?family=Noto+Serif|Nunito:600" rel="stylesheet">


<style>
       

  .noto,body{font-family:serif;font-weight:400}html.noto-serif-loaded .noto,html.noto-serif-loaded body{font-family:"noto serif",serif}.nunito,h1,h2,h3,h4,h5,h6{font-family:sans-serif;font-weight:600}html.nunito-loaded .nunito,html.nunito-loaded h1,html.nunito-loaded h2,html.nunito-loaded h3,html.nunito-loaded h4,html.nunito-loaded h5,html.nunito-loaded h6{font-family:nunito,sans-serif}/*!normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css*/html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}template,[hidden]{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}button,input,select,textarea{font:inherit;margin:0}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:0;margin:0;padding:0}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}html{box-sizing:border-box;font-size:16px;background:#fff}@media(min-width:900px){html{font-size:18px}}@media(min-width:1200px){html{font-size:20px}}*,*::before,*::after{box-sizing:border-box}body{font-size:1rem;font-style:normal;letter-spacing:.01em;line-height:1.5;background:#fff;color:#262626;overflow-x:hidden}p{margin:0 0 1.75rem}em{font-size:1rem;font-style:italic}strong{font-weight:400;font-style:normal;color:#000}a{color:#262626;text-decoration:underline;text-decoration-skip:objects;text-decoration-color:#62c08e;transition:color .5s}a:hover,a:hover:visited{color:#62c08e;transition:color .2s}h1,h2,h3,h4,h5,h6{margin:2.5em 0 .75rem;line-height:1.3;color:#000}h1{font-size:1.75rem}h2{font-size:1.5rem}h3{font-size:1.25rem}h4{font-size:1rem}h5{font-size:1rem}h6{font-size:1rem}h1+h2,h2+h3,h3+h4,h4+h5,h5+h6{margin-top:0}img{max-width:100%;height:auto}pre,code{font-family:courier new,Courier,monospace}pre{overflow:scroll}figure{margin:1rem 0}main{max-width:40rem;margin:0 auto;padding:1.5rem}.skip-to-content{position:absolute;top:-100rem;left:0;font-family:"noto serif",serif}.skip-to-content:focus{top:0}
</style>

  
  <link rel="stylesheet" href="https://derekmorash.com/sass/main.min.314744b9596c313d68ce94e40ed0ad4f5d912770a4a1b2fb76e7a75716745fcc.css" integrity=”sha256-MUdEuVlsMT1ozpTkDtCtT12RJ3CkobL7duenVxZ0X8w&#61;”>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-144113845-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-144113845-1');
  </script>
</head>

<body>
  <a href="#site-main" class="skip-to-content">Skip To Content</a>
  
  <header role="banner" class="site-header">
    <div class="site-header__inner">

      
      <p class="logo"><a href="/">Derek Morash</a></p>
      

      <nav role="navigation" id="site-navigation" class="site-header__nav">
        <ul class="nav-list">
          
          
            <li class="nav-list__item">
              <a href="/blog/" class="nav-list__link">Blog</a>
            </li>
          
            <li class="nav-list__item">
              <a href="/generative/" class="nav-list__link">Generative</a>
            </li>
          
            <li class="nav-list__item">
              <a href="/about/" class="nav-list__link">About</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
 
<main id="site-main" class="site-main">
  <article role="main" class="blog-post">
    <header class="blog-post__header">

      
        <p class="blog-post__categories">
          
            Performance
          
            Animation
          
        </p>
      

      <h1 class="blog-post__title">Simple Image Lazy Loading</h1>

      <aside class="blog-post__metadata">
        
        <p class="blog-post__date">Posted on <time datetime="2017-05-17">May 17, 2017</time></p>
      </aside>
    </header>

    <section class="blog-post__content rte">
      
      

<p>Quick post to explain a simple lazy loading technique. The main idea here is to initially load a very small resolution version of the image at first to speed up initial page load, and then replace that low res image with a higher res version once everything on the page is finished loading.</p>

<p>One thing you need before getting started is two versions of each photo you want to lazy load. One is low res, I chose a 100x100 version, and a high res, I went with 500x500. The low res images are only 2-4kb each so they will speed up the initial page load, giving a faster perceived performance to the user. Most CMS&rsquo;s handle image resizing for you, for example in shopify you can request any size you want using the <a href="https://help.shopify.com/themes/liquid/filters/url-filters#asset_img_url">asset url filter</a>.</p>

<h2 id="markup">Markup</h2>

<p>This might looking confusing. There&rsquo;s an img element but also a background image on the anchor, what&rsquo;s with that? The img element is visually hidden with css, this allows us to use it for loading the high res version of the image without the user seeing it being downloaded. It&rsquo;s also a good idea because the image is technically content.</p>

<p>The background image is what the user actually sees. Using a background image also gives easier control over centre cropping with css <code>background-position: center;</code> and <code>background-size: cover;</code>.</p>

<p>The last thing we need is a data attribute to hold the url for the new high resolution photo we want to be loaded in place of the low res one that is originally loaded.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTML" data-lang="HTML">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card-image&#34;</span>
	<span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/page-two&#34;</span>
	<span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-image: url(tiny-size.jpg);&#34;</span>
	<span style="color:#a6e22e">data-image-full</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;full-size.jpg&#34;</span>&gt;
		&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tiny-size.jpg&#34;</span> /&gt;
&lt;/<span style="color:#f92672">a</span>&gt;</code></pre></div>
<h2 id="css">CSS</h2>

<p>The css for this will depend on your design and layout but main idea here is to make the img tag invisible but still accessible, and to also position the background image on the parent anchor tag so we can actually see the image. I&rsquo;m also using a blur filter, this disguises how low quality the image is initially and also creates a smooth transition when the high res photo replaces it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-CSS" data-lang="CSS">.<span style="color:#a6e22e">card-image</span> {
	<span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
	<span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#fff</span> <span style="color:#66d9ef">center</span> <span style="color:#66d9ef">center</span> <span style="color:#66d9ef">no-repeat</span>;
	<span style="color:#66d9ef">background-size</span>: <span style="color:#66d9ef">cover</span>;
	<span style="color:#66d9ef">filter</span>: blur(<span style="color:#ae81ff">3</span><span style="color:#66d9ef">px</span>); <span style="color:#75715e">/* blur the lowres image */</span>
}

.<span style="color:#a6e22e">card-image</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">img</span> {
	<span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
	<span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
	<span style="color:#66d9ef">opacity</span>: <span style="color:#ae81ff">0</span>; <span style="color:#75715e">/* visually hide the img element */</span>
}</code></pre></div>
<h2 id="javascript">Javascript</h2>

<p>There are a few steps to get this working:</p>

<ul>
<li>wait for page to finish loading</li>
<li>start loading the new high res photos</li>
<li>wait for high res photos to finish loading</li>
<li>switch original low res photo for the new high res photo</li>
</ul>

<p>Start by watching for the load event on the window to execute a function <code>lazyLoad</code> when the page is finished loading, including all images that are loaded initially.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Javascript" data-lang="Javascript">window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, <span style="color:#a6e22e">lazyLoad</span>);
</code></pre></div>
<p>Then in the <code>lazyLoad</code> function we need to get all the elements we want to lazy load images in and loop over them to perform an action on them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Javascript" data-lang="Javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">lazyLoad</span>() {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">card_images</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;.card-image&#39;</span>);
	
	<span style="color:#a6e22e">card_images</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">card_image</span>) {
		
	});
}
</code></pre></div>
<p>For each image we need to swap out the <code>src</code> attribute on the img tag with the URL of the high res version, this will start downloading this new version of the image but the user won&rsquo;t see it happening since it&rsquo;s hidden with CSS.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Javascript" data-lang="Javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">lazyLoad</span>() {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">card_images</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;.card-image&#39;</span>);
	
	<span style="color:#75715e">// loop over each card image
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">card_images</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">card_image</span>) {
		<span style="color:#75715e">// get the URL for the full size image
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">image_url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#39;data-image-full&#39;</span>);
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">content_image</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;img&#39;</span>);
		
		<span style="color:#75715e">// change the src of the content image to load the new high res photo
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">content_image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image_url</span>;
	});
}
</code></pre></div>
<p>And finally we need to listen for the high res versions of the images to finish downloading so we can start displaying that in place of the original low res version. We&rsquo;ll also add a class of <code>is-loaded</code> so we can remove the blur filter.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Javascript" data-lang="Javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">lazyLoad</span>() {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">card_images</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;.card-image&#39;</span>);
	
	<span style="color:#75715e">// loop over each card image
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">card_images</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">card_image</span>) {
		<span style="color:#75715e">// get the URL for the full size image
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">image_url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#39;data-image-full&#39;</span>);
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">content_image</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;img&#39;</span>);
		
		<span style="color:#75715e">// change the src of the content image to load the new high res photo
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">content_image</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">image_url</span>;
		<span style="color:#75715e">// listen for load event when the new photo is finishes loading
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">content_image</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, <span style="color:#66d9ef">function</span>() {
			<span style="color:#75715e">// swap out the visible background image with the new fully downloaded photo
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundImage</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;url(&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">image_url</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;)&#39;</span>;
			<span style="color:#75715e">// add a class to remove the blur filter to smoothly transition the image change
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">card_image</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; is-loaded&#39;</span>;
		});
		
	});
}
</code></pre></div>
<p>The page will now load the blurred out tiny low res image at the start and once everything on the page is done loading it will swap them out for the sharper high res versions.</p>

<h2 id="demo">Demo</h2>

<p><a href="https://codepen.io/derekmorash/pen/NjBvdX">Lazy Load Images</a></p>

    </section>
  </article>
</main>
 
<footer class="site-footer">
  <div class="site-footer__inner">
    <nav class="social-nav">
      <ul class="social-nav__list">
        <li class="social-nav__item">
          <a href="https://www.instagram.com/gammastop/" class="social-nav__link">Instagram</a>
        </li>
        <li class="social-nav__item">
          <a href="https://twitter.com/derek_morash" class="social-nav__link">Twitter</a>
        </li>
        <li class="social-nav__item">
          <a href="https://codepen.io/derekmorash/" class="social-nav__link">Codepen</a>
        </li>
      </ul>
    </nav>

    <small>&copy; 2019 Derek Morash</small>
  </div>
</footer>
</body>
</html>