<!-- image -->
<figure {{ with .Get "class" }}class="{{.}}"{{ end }}>
    
  {{ with .Get "link"}}<a href="{{.}}">{{ end }}

    <picture>
      {{ $src := .Page.Resources.GetMatch (printf "*%s*" (.Get "src")) }}
      <source srcset="{{ $src.RelPermalink }}" type="{{ $src.MediaType }}">
      <img src="{{ $src.RelPermalink }}" {{ if or (.Get "alt") (.Get "caption") }}alt="{{ with .Get "alt"}}{{.}}{{else}}{{ .Get "caption" }}{{ end }}"{{ end }} loading="lazy" />
    </picture>

  {{ if .Get "link"}}</a>{{ end }}


  {{ if or (or (.Get "title") (.Get "caption")) (.Get "attr")}}
  <figcaption>{{ if isset .Params "title" }}
    <h4>{{ .Get "title" }}</h4>{{ end }}
    {{ if or (.Get "caption") (.Get "attr")}}<p>
    {{ .Get "caption" }}
    {{ with .Get "attrlink"}}<a href="{{.}}"> {{ end }}
      {{ .Get "attr" }}
    {{ if .Get "attrlink"}}</a> {{ end }}
    </p> {{ end }}
  </figcaption>
  {{ end }}
</figure>
<!-- image -->